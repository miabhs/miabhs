<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="jakarta.faces.facelets"
                template="/WEB-INF/templates/page.xhtml"
                xmlns:f="jakarta.faces.core"
                xmlns:h="jakarta.faces.html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="jakarta.tags.core"
                xmlns:pe="http://primefaces.org/ui/extensions" >

    <f:metadata>
        <ui:param name="title" value="#{string['pengasuhan.module.title']} - Data Aktifitas" />

        <ui:param name="viewPage" value="#{dataAktifitasPage}" />
        <ui:include src="/WEB-INF/components/core/base/meta/page.xhtml"/>
        
        <ui:param name="dataView" value="#{viewPage.aktifitasList}" /> 
        <ui:param name="filter" value="#{dataView.filter}" /> 
        <ui:param name="pager" value="#{dataView.pager}" />
        <f:viewParam name="pageSize" value="#{pager.pageSize}" converter="LongConverter" />
        <f:viewParam name="offset" value="#{pager.offset}" converter="LongConverter" />
        <ui:param name="contentId" value=":data-frm:#{dataView.name}" />
        
        <f:viewParam name="s" value="#{dataView.selections}" converter="AktifitasListConverter" />
        
        <f:viewParam name="fd" value="#{filter.content.fromDate}" converter="LocalDateConverter" />
        <f:viewParam name="td" value="#{filter.content.thruDate}" converter="LocalDateConverter" />
        <f:viewParam name="nm" value="#{filter.content.name}" converter="QueryStringConverter" />        
        <f:viewParam name="kp" value="#{filter.content.kelompokPengasuhan}" converter="KelompokPengasuhanConverter" />
        <f:viewParam name="st" value="#{filter.content.status}" converter="StatusConverter" />
        <f:viewParam name="sn" value="#{filter.content.santri}" converter="SantriConverter" />
        <f:viewParam name="bs" value="#{filter.content.bentukAktifitas}" converter="BentukAktifitasConverter" />
        <f:viewParam name="js" value="#{filter.content.jenisAktifitas}" converter="JenisAktifitasConverter" />
        <f:viewParam name="na" value="#{filter.content.nilaiAktifitas}" converter="NilaiAktifitasConverter"  />

    </f:metadata>

    <ui:define name="styles">
        <style>
            .ui-selectonemenu-item-group {
                text-align: center;
                font-style: italic;
            }
            .ui-inputwrapper-filled input {
                width: 100%!important
            }
            .field {
                margin-bottom: 0;
            }
        </style>
    </ui:define>

    <ui:define name="module-menu">
        <ui:include src="/WEB-INF/components/app/pengasuhan/module-menu.xhtml" />
    </ui:define>

    <ui:define name="crud-update"/>

    <ui:define name="filter">
        <div class="flex gap-2 flex-nowrap align-items-center flex-shrink-0">
            <p:outputLabel for="periode" value="Periode" />
            <h:panelGroup layout="block" id="periode" class="flex ui-inputgroup">
                <p:datePicker id="from-date" value="#{filter.content.fromDate}"
                              showTime="false"  size="7" locale="#{theApp.locale}"
                              pattern="dd/MM/yyyy" placeholder="Awal" >
                    <p:ajax listener="#{filter.onFiltering}" 
                            oncomplete="refreshContent()" />
                </p:datePicker>                
                <h:panelGroup layout="block" styleClass="ui-inputgroup-addon" >
                    <p:outputLabel value="s.d" />
                </h:panelGroup>
                <p:datePicker id="thru-date" value="#{filter.content.thruDate}"
                              showTime="false" size="7" locale="#{theApp.locale}"
                              pattern="dd/MM/yyyy" placeholder="Akhir" >
                    <p:ajax listener="#{filter.onFiltering}" 
                            oncomplete="refreshContent()" />
                </p:datePicker>
            </h:panelGroup>
        </div>
        <p:divider layout="vertical" />
        <div class="flex align-items-center gap-2">
            <p:outputLabel for="santri" value="Santri" />
            <p:selectOneMenu id="santri" value="#{filter.content.santri}"
                             converter="SantriConverter" 
                             filter="true" filterMatchMode="contains" 
                             filterPlaceholder="Cari..."
                             autoWidth="false"  >                        
                <f:selectItem itemLabel="Semua" itemValue="#{null}" />
                <f:selectItems value="#{viewPage.santriList.fetchedItems}" 
                               var="item" itemValue="#{item}" 
                               itemLabel="#{item.person.name}" />
                <p:ajax listener="#{filter.onFiltering}" 
                        oncomplete="refreshContent()" />
            </p:selectOneMenu>
        </div>
        <p:divider layout="vertical" />
        <div class="flex align-items-center gap-2">
            <p:outputLabel value="Kelompok" />
            <p:selectOneMenu value="#{filter.content.kelompokPengasuhan}" 
                             converter="KelompokPengasuhanAltConverter"
                             filter="true" filterMatchMode="contains"
                             filterPlaceholder="Cari..."
                             autoWidth="false"  >                        
                <f:selectItem itemLabel="Semua" itemValue="#{null}" />
                <f:selectItems value="#{kelompokPengasuhanAltList.fetchedItems}" 
                               var="item" itemValue="#{item}" 
                               itemLabel="#{item.organization.name}" />
                <p:ajax listener="#{filter.onFiltering}" 
                        oncomplete="refreshContent()" />
            </p:selectOneMenu>
        </div>
        <p:divider layout="vertical" />
        <div class="flex align-items-center gap-2">
            <p:outputLabel value="Catatan" />
            <p:selectOneMenu value="#{filter.content.bentukAktifitas}" 
                             converter="BentukAktifitasConverter"
                             filter="true" filterMatchMode="contains" 
                             filterPlaceholder="Cari..."  
                             autoWidth="false" >                        
                <f:selectItem itemLabel="Semua" itemValue="#{null}" />
                <f:selectItems value="#{bentukAktifitasList1.fetchedItems}"
                               var="item" itemValue="#{item}"
                               itemLabel="#{item.bentuk}" />
                <p:ajax listener="#{filter.onFiltering}" 
                        oncomplete="refreshContent()" />
            </p:selectOneMenu>
        </div>
        <p:divider layout="vertical" />
        <div class="flex align-items-center gap-2 ">
            <p:outputLabel value="Jenis" />                            
            <p:selectOneMenu value="#{filter.content.jenisAktifitas}"
                             converter="JenisAktifitasConverter" 
                             autoWidth="false" >                        
                <f:selectItem itemLabel="Semua" itemValue="#{null}" />
                <f:selectItems value="#{jenisAktifitasList.fetchedItems}" 
                               var="item" itemValue="#{item}"
                               itemLabel="#{item.label}" />
                <p:ajax listener="#{filter.onFiltering}" 
                        oncomplete="refreshContent()" />
            </p:selectOneMenu>
        </div>
        <p:divider layout="vertical" />
        <div class="flex align-items-center gap-2">
            <p:outputLabel value="Bobot"/> 
            <h:panelGroup styleClass="ui-inputgroup">
                <h:panelGroup id="icon" layout="block" styleClass="ui-inputgroup-addon #{filter.content.nilaiAktifitas.color}" />
                <p:selectOneMenu value="#{filter.content.nilaiAktifitas}"
                                 converter="NilaiAktifitasConverter" 
                                 var ="nilai" autoWidth="false"  >                       
                    <f:selectItem itemLabel="Semua" itemValue="#{null}" />
                    <f:selectItems value="#{nilaiAktifitasList.fetchedItems}" var="item"
                                   itemLabel="#{item.label}" itemValue="#{item}" />
                    <p:column>
                        <div class="p-0 flex flex-column justify-content-center align-items-center w-full h-2rem #{nilai.color}">
                            <h:outputText value = "#{nilai.label}" class="font-bold text-white" />
                        </div>
                    </p:column>
                    <p:ajax listener="#{filter.onFiltering}" 
                            oncomplete="refreshContent()" />
                </p:selectOneMenu>
            </h:panelGroup>
        </div>
    </ui:define>

    <ui:define name="content"> 
        <h:form id="data-frm" class="flex-grow-1 flex align-items-stretch">
            <ui:include src="/WEB-INF/components/app/pengasuhan/aktifitaslist.xhtml">
                <ui:param name="editable" value="true" />
                <ui:param name="selectListener" value=":tools-frm" />
            </ui:include>
        </h:form>
    </ui:define>

    <ui:define name="pager">
        <ui:include src="/WEB-INF/components/core/base/pager.xhtml">
            <ui:param name="pagerListener" value=":data-frm:#{dataView.name}" />2
        </ui:include>
    </ui:define>

</ui:composition>